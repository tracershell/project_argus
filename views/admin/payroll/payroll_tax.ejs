<style>
  body.payroll-page {
    margin: 0;
    font-family: Arial, sans-serif;
    background-color: #f5f7fa;
    color: #333;
    font-size: 12px;
  }

  h2 {
    font-size: 20px;
    color: #333;
    margin-bottom: 15px;
  }

  input, select, textarea {
    padding: 4px;
    font-size: 12px;
    border: 1px solid #ccc;
    border-radius: 4px;
    height: 24px;
  }

  button {
    padding: 4px 12px;
    font-size: 12px;
    border: 1px solid #066da5;
    border-radius: 4px;
    background-color: #fff;
    cursor: pointer;
  }

  .container { margin: 0 20px; }
  .form-group { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 20px; }
  .form-group select { min-width: 200px; }
  .reference-btn { margin-left: 0.5rem; }

  .payroll-table-wrapper {
  display: flex;
  flex-wrap: nowrap; /* í•œ ì¤„ë¡œ ê°•ì œ */
  overflow-x: auto;  /* ë„ˆë¹„ ì´ˆê³¼ ì‹œ ìŠ¤í¬ë¡¤ í—ˆìš© */
  gap: 10px;
  margin-bottom: 20px;
  padding: 10px;
  background-color: #f5f7fa;
  border-radius: 8px;
}

  .payroll-group {
    display: flex;
    gap: 1rem;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 10px;
    flex-direction: row;
    align-items: flex-start;
    background-color: #fff;
  }

  .payroll-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
  }

  .payroll-item input {
  width: 93px;   /* ê¸°ì¡´ 70pxì—ì„œ ì‚´ì§ ì¤„ì„ */
}
  .payroll-item label {
    font-weight: bold;
  }

  .payroll-form { width: 100%; box-sizing: border-box; }
  .row { margin-bottom: 20px; }

  .remark-inline {
    display: flex;
    align-items: center;
    gap: 6rem;
    margin-bottom: 20px;
    flex-wrap: wrap;
  }

  .remark-inline input {
    flex: 0 0 200px;
    min-width: 200px;
  }

  .work-info {
    display: flex;
    gap: 6rem;
    align-items: center;
  }

  .footer-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 20px;
    flex-wrap: wrap;
    gap: 1rem;
  }

  .footer-left, .footer-center, .footer-right {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .footer-center {
    justify-content: center;
    flex: 1;
  }

  .back-button-row {
    display: flex;
    justify-content: center;
    margin-top: 30px;
  }

  .back-button-row button {
    padding: 4px 12px;
    font-size: 12px;
    background-color: #fff;
    border: 1px solid #666;
    border-radius: 4px;
    cursor: pointer;
  }

  .back-button-row button:hover {
    background-color: #eee;
  }

  #saveComment {
    text-align: center;
    margin-top: 10px;
    font-size: 0.95rem;
    color: green;
  }

  .blue-text {
    color: #007bff;
    font-weight: bold;
  }

  .red-text {
    color: red;
    font-weight: bold;
  }

  .pay-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 12px;
  background-color: #fff;
  margin-top: 20px;
}

.pay-table thead {
  background-color: #f0f8ff;
}

.pay-table th, .pay-table td {
  border: 1px solid #ccc;
  padding: 6px;
  text-align: center;
  white-space: nowrap;
}

.pay-table th {
  font-weight: bold;
  color: #333;
}

.pay-table td {
  color: #444;
}

.pay-table tr:nth-child(even) {
  background-color: #f9f9f9;
}

.pay-table tr:hover {
  background-color: #eef6ff;
}

.pay-table-wrapper {
    max-height: 500px;
    overflow-y: auto;
    border: 1px solid #ccc;
  }

  .calculate-btn {
  background-color: #ffe5e5;  /* ì—·ì€ ë¶‰ì€ìƒ‰ */
  border: 1px solid #cc6666;
  color: #b30000;
  font-weight: bold;
}
.calculate-btn:hover {
  background-color: #ffcccc;  /* hover ì‹œ ì•½ê°„ ë” ì§„í•œ ë¶‰ì€ í†¤ */
}

/* ì—·ì€ íŒŒë€ìƒ‰ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
.light-blue {
  background-color: #e6f0ff;       /* ì•„ì£¼ ì—°í•œ íŒŒë‘ (#f0f8ff ë„ ê°€ëŠ¥) */
  border: 1px solid #99bbff;       /* íŒŒë€ ê³„ì—´ í…Œë‘ë¦¬ */
  color: #003366;                  /* ì–´ë‘ìš´ íŒŒë€ í…ìŠ¤íŠ¸ */
  font-weight: bold;
  border-radius: 4px;
}

.light-blue:hover {
  background-color: #cce0ff;       /* hover ì‹œ ì•½ê°„ ë” ì§„í•œ ì—°íŒŒë‘ */
}

</style>

</head>
<body class="payroll-page">
  <h2>Pay List</h2>
  <div class="container">
    <form id="payrollForm" action="/admin/payroll/payroll_tax/add" method="post" class="payroll-form" onsubmit="return showSaveComment()">
      <div class="row">
        <div class="form-group">
          <label for="name">Name :</label>
          <select id="ep_ref" name="name" onchange="updateReferenceInfo()">
            <option value="">-- Select Employee --</option>
            <% employees.forEach(emp => { %>
              <option value="<%= emp.name %>" data-eid="<%= emp.eid %>" data-jcode="<%= emp.jcode %>" data-jtitle="<%= emp.jtitle %>" data-work1="<%= emp.work1 %>">
                <%= emp.name %>
              </option>
            <% }) %>
          </select>
          <button type="button" class="reference-btn light-blue" onclick="loadLatestPaylist()" class="reference-btn">Reference</button>
          <span id="eidDisplay" class="blue-text"></span>
        </div>
      </div>

      <% if (selectedEidName) { %>
        <div style="text-align: center; margin-bottom: 1rem;">
          <span class="red-text">ì´ì „ ì…ë ¥ ìë£Œ | <%= selectedEidName %></span>
        </div>
      <% } %>

      <div class="row">
        <label for="pdate">Pay Date :</label>
        <input type="date" name="pdate" id="pdate" value="<%= selectedPdate %>" required>
      </div>

      <div class="payroll-table-wrapper">
        <div class="payroll-group">
          <div class="payroll-item"><label>Check No.</label><input type="text" name="ckno_table" autocomplete="off"></div>
        </div>
        <div class="payroll-group">
          <div class="payroll-item"><label>R.T</label><input type="text" name="rtime" autocomplete="off" oninput="formatDecimal(this)"></div>
          <div class="payroll-item"><label>O.T</label><input type="text" name="otime" autocomplete="off" oninput="formatDecimal(this)"></div>
          <div class="payroll-item"><label>D.T</label><input type="text" name="dtime" autocomplete="off" oninput="formatDecimal(this)"></div>
        </div>
        <div class="payroll-group">
          <div class="payroll-item"><label>FW</label><input type="text" name="fw" autocomplete="off" oninput="formatDecimal(this)"></div>
          <div class="payroll-item"><label>SSE</label><input type="text" name="sse" autocomplete="off" oninput="formatDecimal(this)"></div>
          <div class="payroll-item"><label>ME</label><input type="text" name="me" autocomplete="off" oninput="formatDecimal(this)"></div>
        </div>
        <div class="payroll-group">
          <div class="payroll-item"><label>CA-W</label><input type="text" name="caw" autocomplete="off" oninput="formatDecimal(this)"></div>
          <div class="payroll-item"><label>CA-de</label><input type="text" name="cade" autocomplete="off" oninput="formatDecimal(this)"></div>
        </div>
        <div class="payroll-group">
          <div class="payroll-item"><label>ADV.</label><input type="text" name="adv" autocomplete="off" oninput="formatDecimal(this)"></div>
          <div class="payroll-item"><label>C.S</label><input type="text" name="csp" autocomplete="off" oninput="formatDecimal(this)"></div>
          <div class="payroll-item"><label>D.D</label><input type="text" name="dd" autocomplete="off"oninput="formatDecimal(this)"></div>
        </div>
        <div class="payroll-group" style="align-items: center; justify-content: center;">
          <div class="payroll-item" style="margin-top: 22px;">
            <button type="button" class="calculate-btn" onclick="calculateNet()">ì´ì•¡ ê³„ì‚°</button>
          </div>
        </div>
        <div class="payroll-group">
          <div class="payroll-item"><label>Gross</label><input type="text" name="gross" autocomplete="off" oninput="formatDecimal(this)"></div>
          <div class="payroll-item"><label>Tax</label><input type="text" name="tax" autocomplete="off"oninput="formatDecimal(this)"></div>
          <div class="payroll-item"><label>Net</label><input type="text" name="net" autocomplete="off"oninput="formatDecimal(this)"></div>
        </div>
      </div>

      <div class="remark-inline">
        <div class="payroll-group"> 
        <label for="remark">Remark :</label>
        <input type="text" name="remark" id="remark">
        <div class="work-info">
          <span>W.code: <span id="jcodeDisplay" class="blue-text"></span></span>
          <span>W.title: <span id="jtitleDisplay" class="blue-text"></span></span>
          <span>W.location: <span id="work1Display" class="blue-text"></span></span>
        </div>
        </div>
      </div>

      <div class="footer-actions">
        <div class="footer-left">
          <div class="payroll-group">
          <label for="ckno">Check No. :</label>
          <input type="text" name="ckno" id="ckno">
          <button type="button" id="btn-select">ì„ íƒ</button>
          <button type="button" id="btn-update">ìˆ˜ì •</button>
          <button type="button" id="btn-delete">ì‚­ì œ</button>
          </div>
        </div>
        
        
        <div class="footer-right">
          <button type="submit">ì…ë ¥ì €ì¥</button>
        </div>
      </div>
      <div id="saveComment"></div>
      <input type="hidden" name="eid" id="hiddenEid">
      <input type="hidden" name="jcode" id="hiddenJcode">
      <input type="hidden" name="jtitle" id="hiddenJtitle">
      <input type="hidden" name="work1" id="hiddenWork1">
    </form>
  
  </div>
<!-- âœ… í•˜ë‹¨ Pay List Table -->
<h3 style="margin-top: 40px; border-top: 1px solid #ccc; padding-top: 20px;">Pay Records (Selected Pay Date)</h3>

<div class="footer-center">
  <div class="payroll-group">  [Payroll List ë³´ê¸°]
  <% // âœ… ì½¤ë³´ë°•ìŠ¤: ë“±ë¡ëœ pay date ëª©ë¡ì„ ì˜µì…˜ìœ¼ë¡œ í‘œì‹œ %>
  <form method="get" style="display: inline;">
    <select name="pdate" required onchange="this.form.submit()">
      <option value="">:: Select Pay Date ::</option>
      <% dates.forEach(date => { %>
        <option value="<%= date.pdate.toISOString().split('T')[0] %>" 
          <%= selectedDate === date.pdate.toISOString().split('T')[0] ? 'selected' : '' %>>
          <%= new Date(date.pdate).toLocaleDateString('en-US') %>
        </option>
      <% }) %>
    </select>
  </form>
  <button type="button" onclick="viewPaylistPDF()">ğŸ“„ View PDF</button>  
  <button type="button" onclick="downloadCSV()">ğŸ’¾ CSV ì €ì¥</button>
  </div>
  <div class="payroll-group">
  Start Check No: <input type="text" id="startCkno" style="width: 80px;">
  End Check No: <input type="text" id="endCkno" style="width: 80px;">
  <button type="button" onclick="viewReferencePDF()">ğŸ“„ Reference PDF</button>
  </div>
  <button type="button" onclick="handleResultClick()">ğŸ“Š Result</button>
</div>

<div class="pay-table-wrapper">
<table class="pay-table">
  <thead>
    <tr>
      <th>Pay Date</th>
      <th>EID</th>
      <th>Name</th>
      <th>Check No</th>
      <th>R.T</th>
      <th>O.T</th>
      <th>D.T</th>
      <th>FW</th>        
      <th>SSE</th>       
      <th>ME</th>        
      <th>CA-W</th>
      <th>CA-de</th>
      <th>ADV.</th>
      <th>C.S</th>
      <th>D.D</th>
      <th>Gross</th>
      <th>Tax</th>
      <th>Net</th>
      <th>Remark</th>
    </tr>
  </thead>
  <tbody>
    <% if (paylist && paylist.length > 0) { %>
      <% paylist.forEach(row => { %>
        <tr>
          <td>
            <% // âœ… ë‚ ì§œ í˜•ì‹ ë³€í™˜í•˜ì—¬ ì¶œë ¥ (MM/DD/YYYY) %>
            <%= new Date(row.pdate).toLocaleDateString('en-US', {
              year: 'numeric',
              month: '2-digit',
              day: '2-digit'
            }) %>
          </td> 
          <td><%= row.eid %></td>
          <td><%= row.name %></td>
          <td><%= row.ckno %></td>
          <td><%= row.rtime %></td>
          <td><%= row.otime %></td>
          <td><%= row.dtime %></td>
          <td><%= row.fw %></td>      
          <td><%= row.sse %></td>     
          <td><%= row.me %></td>      
          <td><%= row.caw %></td>
          <td><%= row.cade %></td>
          <td><%= row.adv %></td>
          <td><%= row.csp || row.csp %></td>
          <td><%= row.dd %></td>
          <td><%= row.gross %></td>
          <td><%= row.tax %></td>
          <td><%= row.net %></td>
          <td><%= row.remark || '' %></td>
        </tr>
      <% }) %>
    <% } else { %>
      <tr><td colspan="14" style="text-align:center; padding: 10px;">ì„ íƒí•œ ë‚ ì§œì— ëŒ€í•œ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>
    <% } %>
  </tbody>

</div>

  <script>
    function updateReferenceInfo() {
      const selected = document.querySelector('#ep_ref');
      const option = selected.options[selected.selectedIndex];

      const eidVal = option.getAttribute('data-eid') || '';
      const jcodeVal = option.getAttribute('data-jcode') || '';
      const jtitleVal = option.getAttribute('data-jtitle') || '';
      const work1Val = option.getAttribute('data-work1') || '';

      document.getElementById('eidDisplay').innerText = eidVal;
      document.getElementById('jcodeDisplay').innerText = jcodeVal;
      document.getElementById('jtitleDisplay').innerText = jtitleVal;
      document.getElementById('work1Display').innerText = work1Val;

      document.getElementById('hiddenEid').value = eidVal;
      document.getElementById('hiddenJcode').value = jcodeVal;
      document.getElementById('hiddenJtitle').value = jtitleVal;
      document.getElementById('hiddenWork1').value = work1Val;
    }

    function loadLatestPaylist() {
  const selected = document.querySelector('#ep_ref');
  const eid = selected.options[selected.selectedIndex]?.getAttribute('data-eid');

  if (!eid) {
    alert('ì§ì›ì„ ì„ íƒí•˜ì„¸ìš”.');
    return;
  }

  // âœ… ë¨¼ì € ëª¨ë“  í•„ë“œ ì´ˆê¸°í™”
  const clearFields = ['rtime', 'otime', 'dtime', 'fw', 'sse', 'me', 'caw', 'cade', 'adv', 'csp', 'dd', 'gross', 'tax', 'net', 'remark'];
  clearFields.forEach(field => {
    const input = document.querySelector(`[name="${field}"]`);
    if (input) input.value = '';
  });

  // âœ… fetch ìš”ì²­
  fetch(`/admin/payroll/payroll_tax/paylist/latest?eid=${eid}`)
    .then(res => res.json())
    .then(data => {
      if (!data || !data.success) {
        alert('ìµœê·¼ ê¸‰ì—¬ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }

      const fields = ['rtime', 'otime', 'dtime', 'fw', 'sse', 'me', 'caw', 'cade', 'adv', 'csp', 'dd', 'remark'];
      fields.forEach(field => {
        if (data[field] !== undefined) {
          if (field === 'remark') {
            document.querySelector(`[name="${field}"]`).value = data[field];
          } else {
            document.querySelector(`[name="${field}"]`).value = parseFloat(data[field]).toLocaleString('en-US', {
              minimumFractionDigits: 2,
              maximumFractionDigits: 2
            });
          }
        }
      });

      // calculateNet();  // í•„ìš”í•˜ë©´ ì´ ë¶€ë¶„ë„ ì£¼ì„ í•´ì œ
    })
    .catch(err => {
      console.error('Reference ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:', err);
      alert('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    });
}


function showSaveComment() {
  const selected = document.querySelector('#ep_ref');
  const name = selected.value;
  const eid = selected.options[selected.selectedIndex]?.getAttribute('data-eid') || '';
  const commentBox = document.getElementById('saveComment');
  commentBox.innerText = `eid: ${eid} / ${name} ì´ ì§€ê¸ˆ ì…ë ¥ë˜ì—ˆìŠµë‹ˆë‹¤.`;
  return true;
}

    function formatDecimal(input) {
  let value = input.value;

  // ìˆ«ìì™€ ì†Œìˆ˜ì ë§Œ í—ˆìš©
  value = value.replace(/[^\d.]/g, '');

  // ì†Œìˆ˜ì  1ê°œë§Œ ìœ ì§€
  const parts = value.split('.');
  if (parts.length > 2) {
    value = parts[0] + '.' + parts[1];
  }

  input.value = value; // ì…ë ¥ ì¤‘ì—ëŠ” ê°€ê³µí•˜ì§€ ì•ŠìŒ

  // í¬ì»¤ìŠ¤ ë²—ì–´ë‚  ë•Œ í¬ë§· ì ìš©
  input.addEventListener('blur', () => {
    const num = parseFloat(input.value.replace(/,/g, '')); // ì‰¼í‘œ ì œê±° í›„ ìˆ«ì ë³€í™˜
    if (!isNaN(num)) {
      // ì†Œìˆ˜ì  2ìë¦¬ + ì‰¼í‘œ í˜•ì‹ ì ìš©
      input.value = num.toLocaleString('en-US', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      });
    }
  });
}

function calculateNet() {
  const rtime = parseFloat(document.querySelector('[name="rtime"]').value.replace(/,/g, '')) || 0;
  const otime = parseFloat(document.querySelector('[name="otime"]').value.replace(/,/g, '')) || 0;
  const dtime = parseFloat(document.querySelector('[name="dtime"]').value.replace(/,/g, '')) || 0;

  const fw = parseFloat(document.querySelector('[name="fw"]').value.replace(/,/g, '')) || 0;
  const sse = parseFloat(document.querySelector('[name="sse"]').value.replace(/,/g, '')) || 0;
  const me = parseFloat(document.querySelector('[name="me"]').value.replace(/,/g, '')) || 0;
  const caw = parseFloat(document.querySelector('[name="caw"]').value.replace(/,/g, '')) || 0;
  const cade = parseFloat(document.querySelector('[name="cade"]').value.replace(/,/g, '')) || 0;

  const gross = rtime + otime + dtime;
  const tax = fw + sse + me + caw + cade;
  const net = gross - tax;

  const grossField = document.querySelector('[name="gross"]');
  const taxField = document.querySelector('[name="tax"]');
  const netField = document.querySelector('[name="net"]');

  grossField.value = gross.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
  taxField.value = tax.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
  netField.value = net.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
}


    document.addEventListener('DOMContentLoaded', () => {
      const fieldNames = ['ckno_table', 'rtime', 'otime', 'dtime', 'fw', 'sse', 'me', 'caw', 'cade', 'adv', 'csp', 'dd', 'remark'];
      const fields = fieldNames.map(name => document.querySelector(`[name="${name}"]`)).filter(el => el);

      fields.forEach((field, index) => {
        field.addEventListener('keydown', (e) => {
          if (e.key === 'Enter') {
            e.preventDefault();
            const next = fields[index + 1];
            if (next) next.focus();
          }
        });
      });
    });

/* ì¶œë ¥ìš© Javascript í•¨ìˆ˜
function viewPaylistPDF() {
  const date = document.getElementById('selectedDate').value;
  if (!date) {
    alert("ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”.");
    return;
  }
  window.open(`/payroll/pdf-view?pdate=${date}`, '_blank');
}
*/
// window.open(`/admin/payroll/payroll_tax_result/pdfdownload?pdate=${date}`, '_blank');


function viewPaylistPDF() {
  const date = document.querySelector('select[name="pdate"]').value;
  if (!date) {
    alert("ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”.");
    return;
  }
  window.open(`/admin/payroll/payroll_tax_pdf/pdf?pdate=${date}`, '_blank');
}



// function printPaylistPDF() {
//   const date = document.getElementById('selectedDate').value;
//   if (!date) {
//     alert("ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”.");
//     return;
//   }
//   window.open(`/payroll/pdf-generate?pdate=${date}`, '_blank');
// } 

// CVS ì¶œë ¥ ìš© (Client ì¸¡ download)

function downloadCSV() {
  const pdate = document.querySelector('select[name="pdate"]').value;
  if (!pdate) {
    alert("ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”.");
    return;
  }
  window.open(`/admin/payroll/payroll_tax_csv/csv-export?pdate=${pdate}`, '_blank');
}




function validateForm() {
  const name = document.querySelector('[name="name"]').value;
  const ckno = document.querySelector('[name="ckno"]').value;
  const gross = document.querySelector('[name="gross"]').value;

  if (!name || !ckno || !gross) {
    alert('Name, Check No, Gross ê°’ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.');
    return false;
  }
  return true;
}

function viewReferencePDF() {
  const start = document.getElementById('startCkno').value;
  const end = document.getElementById('endCkno').value;

  if (!start || !end) {
    alert("Check No ë²”ìœ„ë¥¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.");
    return;
  }

  window.open(`/admin/payroll/payroll_tax_refpdf/refpdf?startCkno=${start}&endCkno=${end}`, '_blank');
}

// ì„ íƒ ìˆ˜ì • ì‚­ì œ Script 

document.getElementById('btn-select').addEventListener('click', selectRecord);
document.getElementById('btn-update').addEventListener('click', updateRecord);
document.getElementById('btn-delete').addEventListener('click', deleteRecord);


function selectRecord() {
  const ckno = document.getElementById('ckno').value;
  if (!ckno) return alert("Check No.ë¥¼ ì…ë ¥í•˜ì„¸ìš”");

  fetch(`/admin/payroll/payroll_tax/select?ckno=${encodeURIComponent(ckno)}`)
    .then(res => res.json())
    .then(data => {
      if (!data.success) return alert("í•´ë‹¹ Check No.ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
      const record = data.data;

      // âœ… ê³µí†µ í•„ë“œ ìë™ ë°˜ì˜
      for (const key in record) {
        const field = document.querySelector(`[name="${key}"]`);
        if (field) field.value = record[key];
      }

// âœ… íƒ€ì„ì¡´ ì˜í–¥ ì—†ì´ ë‚ ì§œ ë°˜ì˜ (YYYY-MM-DD ë¬¸ìì—´ ê·¸ëŒ€ë¡œ ì‚¬ìš©)
const pdateInput = document.querySelector('[name="pdate"]');
if (pdateInput && record.pdate) {
  pdateInput.value = record.pdate.slice(0, 10);
}

      // âœ… ckno_table í•„ë“œ ìˆ˜ë™ ë°˜ì˜
      const cknoTableInput = document.querySelector('[name="ckno_table"]');
      if (cknoTableInput && record.ckno) {
        cknoTableInput.value = record.ckno;
      }

      calculateNet(); // ê¸ˆì•¡ ë‹¤ì‹œ ê³„ì‚°
    })
    .catch(err => {
      console.error('ì„ íƒ ì¤‘ ì˜¤ë¥˜:', err);
      alert("ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ ë°œìƒ");
    });
}


function updateRecord() {
  const ckno = document.getElementById('ckno').value;
  if (!ckno) return alert("Check No.ë¥¼ ì…ë ¥í•˜ì„¸ìš”");

  const form = document.getElementById('payrollForm');
  form.action = '/admin/payroll/payroll_tax/update';
  form.submit();
}

function deleteRecord() {
  const ckno = document.getElementById('ckno').value;
  if (!ckno) return alert("Check No.ë¥¼ ì…ë ¥í•˜ì„¸ìš”");

  if (!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

  fetch('/admin/payroll/payroll_tax/delete', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({ ckno })
  })
    .then(res => res.json())
    .then(result => {
      if (result.success) {
        alert("ì‚­ì œ ì™„ë£Œ");
        resetForm();           // âœ… ì‚­ì œ í›„ í¼ ì´ˆê¸°í™”
        location.reload();     // ğŸ” ìƒˆë¡œê³ ì¹¨ì´ í•„ìš” ì—†ë‹¤ë©´ ì´ ì¤„ì€ ì œê±° ê°€ëŠ¥
      } else {
        alert("ì‚­ì œ ì‹¤íŒ¨ ë˜ëŠ” í•´ë‹¹ Check No. ì—†ìŒ");
      }
    });
}

function resetForm() {
  const form = document.getElementById('payrollForm');
  form.reset();

  // ìˆ¨ê²¨ì§„ í•„ë“œ, ì°¸ì¡° í•„ë“œë“¤ë„ ì´ˆê¸°í™”
  document.getElementById('eidDisplay').innerText = '';
  document.getElementById('jcodeDisplay').innerText = '';
  document.getElementById('jtitleDisplay').innerText = '';
  document.getElementById('work1Display').innerText = '';

  document.getElementById('hiddenEid').value = '';
  document.getElementById('hiddenJcode').value = '';
  document.getElementById('hiddenJtitle').value = '';
  document.getElementById('hiddenWork1').value = '';

  document.getElementById('saveComment').innerText = '';
}

  // âœ… 1. onclick="handleResultClick()" í•¨ìˆ˜ ì •ì˜
  function handleResultClick() {
    window.open('/admin/payroll/payroll_tax_result', '_self'); // í˜„ì¬ ì°½ì—ì„œ ì´ë™
  }
 </script>
</body>
</html>