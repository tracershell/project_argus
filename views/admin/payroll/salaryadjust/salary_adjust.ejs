
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Salary Adjustment Calculation</title>
  <style>
    body { font-family: Arial; font-size: 12px; background: #f5f7fa; color: #333; padding: 20px; }
    h2 { font-size: 20px; margin-bottom: 20px; }
    .form-section { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
    input, select, button { padding: 4px 8px; font-size: 12px; height: 24px; }
    button { background: #066da5; color: white; border: none; border-radius: 4px; cursor: pointer; height: 28px; }
    .results { margin-top: 20px; border: 1px solid #ccc; padding: 12px; background: white; }
    .result-line { margin-bottom: 6px; }
  </style>
</head>
<body>
  <h2>Salary Adjustment Calculation</h2>
  <div class="form-section">
  <!-- ğŸ”½ ì—°ë„ ì„ íƒ -->
  <select id="year">
    <option value="">ë…„ë„ ì„ íƒ</option>
    <% for (let y = 2024; y <= 2035; y++) { %>
      <option value="<%= y %>"><%= y %>ë…„</option>
    <% } %>
  </select>

    <select id="month">
      <option value="">ì›” ì„ íƒ</option>
      <% for (let m = 1; m <= 12; m++) { %>
        <option value="<%= m %>"><%= m %>ì›”</option>
      <% } %>
    </select>
    <input type="number" id="deduction" placeholder="ê³µì œì¼ ìˆ˜" min="0">
    <input type="number" step="0.01" id="salary" placeholder="ì›” ê¸‰ì—¬ ($)">
    <button onclick="calculateSalary()">ê³„ì‚°</button>
    <button onclick="openPdf()">PDF ë³´ê¸°</button>
  </div>

  <div id="results" class="results"></div>

  <script>
    let lastResult = null;

    function calculateSalary() {
      const month = document.getElementById('month').value;
      const salary = parseFloat(document.getElementById('salary').value);
      const deduction = parseInt(document.getElementById('deduction').value);
      const year = new Date().getFullYear();

      if (!month || !salary || isNaN(deduction)) return alert('ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”');

      const totalDays = new Date(year, month, 0).getDate();
      let saturdays = 0, sundays = 0;
      for (let i = 1; i <= totalDays; i++) {
        const day = new Date(year, month - 1, i).getDay();
        if (day === 6) saturdays++;
        if (day === 0) sundays++;
      }

      const workDays = totalDays - saturdays - sundays;
      const actualDays = workDays - deduction;
      const adjusted = salary * (actualDays / workDays);
      const fixed = Math.round(adjusted);

      lastResult = {
        year,
        month,
        deduction,
        totalDays,
        saturdays,
        sundays,
        workDays,
        adjustedWorkDays: actualDays,
        adjSalary: adjusted.toFixed(2),
        fixSalary: fixed.toFixed(2),
        originalSalary: salary.toFixed(2)
      };

      document.getElementById('results').innerHTML = `
        <div class="result-line">ì´ ì¼ìˆ˜: ${totalDays}ì¼</div>
        <div class="result-line">í† ìš”ì¼: ${saturdays}ì¼</div>
        <div class="result-line">ì¼ìš”ì¼: ${sundays}ì¼</div>
        <div class="result-line">ê·¼ë¬´ì¼ìˆ˜: ${workDays}ì¼</div>
        <div class="result-line">ì‹¤ê·¼ë¬´ì¼ìˆ˜: ${actualDays}ì¼</div>
        <div class="result-line">ê¸°ë³¸ê¸‰: $${salary.toFixed(2)}</div>
        <div class="result-line">ì¡°ì •ê¸‰ì—¬: $${adjusted.toFixed(2)}</div>
        <div class="result-line">ë°˜ì˜¬ë¦¼ê¸ˆì•¡: <b>$${fixed.toFixed(2)}</b></div>
        <div class="result-line">ìˆ˜ì‹: ($${salary.toFixed(2)} Ã— ${actualDays}) Ã· ${workDays} = $${adjusted.toFixed(2)}</div>
      `;
    }

    function openPdf() {
      if (!lastResult) return alert('ë¨¼ì € ê³„ì‚°ì„ í•´ ì£¼ì„¸ìš”');
      const query = new URLSearchParams(lastResult).toString();
      window.open('/admin/payroll/salaryadjust/salary_adjust_viewpdf?' + query, '_blank');
    }
  </script>
</body>
</html>
