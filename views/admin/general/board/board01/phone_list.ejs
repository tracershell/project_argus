<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Phone List Management</title>
  <style>
    body.employee-page {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #f5f7fa;
      color: #333;
      font-size: 12px;
    }
    h2 {
      font-size: 20px;
      margin-bottom: 15px;
    }
    button {
      padding: 4px 12px;
      font-size: 12px;
      border: 1px solid #066da5;
      border-radius: 4px;
      background-color: #fff;
      cursor: pointer;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 4px;
      text-align: center;
      font-weight: normal;
    }
    input[type="text"], input[type="email"], input[type="number"], select {
      padding: 4px;
      font-size: 12px;
      border: 1px solid #ccc;
      border-radius: 4px;
      height: 24px;
    }
    .top-section, .filter-section, .bottom-section {
      padding: 10px;
    }
    .form {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      width: 100%;
      justify-content: space-between;
    }
    .form input, .form select {
      flex: 1 1 auto;
    }
    .table-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .compact-table th {
      background-color: #f0f8ff;
      position: sticky;
      top: 0;
      z-index: 2;
    }
    .compact-table tbody tr:hover {
      background-color: #e9f5ff;
    }
    .highlight {
      background-color: #ffff99;
    }

    .highlight {
  background-color: #fff799; /* ì¢€ ë” ì§„í•œ ë¶€ë“œëŸ¬ìš´ ë…¸ë€ìƒ‰ */
}

/* âœ… í…Œì´ë¸”ì„ ê°ì‹¸ëŠ” ì˜ì—­ */
.table-wrapper {
  max-height: 450px; /* 450pxê¹Œì§€ë§Œ ë³´ì—¬ì£¼ê³  ë„˜ì¹˜ë©´ ìŠ¤í¬ë¡¤ */
  overflow-y: auto;
  border: 1px solid #ccc;
}

/* âœ… í…Œì´ë¸” í—¤ë” ê³ ì • */
.compact-table th {
  background-color: #f0f8ff;
  position: sticky;
  top: 0;
  z-index: 2;
}

/* âœ… í…Œì´ë¸” ì „ì²´ ìŠ¤íƒ€ì¼ */
table {
  width: 100%;
  border-collapse: collapse;
  font-size: 12px;
}

/* âœ… ì…€ ìŠ¤íƒ€ì¼ */
th, td {
  border: 1px solid #ccc;
  padding: 4px;
  text-align: center;
  font-weight: normal;
}

/* âœ… í…Œì´ë¸” row hover íš¨ê³¼ */
.compact-table tbody tr:hover {
  background-color: #e9f5ff;
}

/* âœ… highlight ìŠ¤íƒ€ì¼ */
.highlight {
  background-color: #fff799;
}
  </style>
</head>

<body class="employee-page">

<!-- âœ… 1. ì…ë ¥/ìˆ˜ì •/ì‚­ì œ ì˜ì—­ -->
<div class="top-section">
  <div class="table-header">
    <h2>Input / Edit / Delete</h2>
  </div>

  <form id="phoneForm" action="/admin/general/board/board01/phone_list/add" method="post" class="form">
    <input type="text" name="department" placeholder="Department (ë¶€ë¬¸)">
    <input type="text" name="keyword" placeholder="Keyword (í‚¤ì›Œë“œ)">
    <input type="number" name="importance" placeholder="Importance (1~5)">
    <input type="text" name="name" placeholder="Name" required>
    <input type="text" name="personal_phone" placeholder="Personal Phone">
    <input type="text" name="office_phone" placeholder="Office Phone">
    <input type="email" name="email" placeholder="Email">
    <input type="text" name="note" placeholder="Note">
  </form>

  <div style="display: flex; justify-content: center; align-items: center; gap: 1rem; margin-top: 1rem;">
    <button type="button" onclick="clearFormInputs()">ğŸ§¹ ì…ë ¥ì´ˆê¸°í™”</button>
    <button form="phoneForm" type="submit">â• ì…ë ¥ì €ì¥</button>
    <input type="text" id="selectedIdInput" placeholder="ID ì…ë ¥" style="padding: 0.3rem;">
    <button type="button" onclick="selectPhone()">ğŸ” ì„ íƒ</button>
    <button type="button" onclick="prepareEdit()">âœï¸ ìˆ˜ì •</button>
    <button type="button" onclick="prepareDelete()">ğŸ—‘ï¸ ì‚­ì œ</button>
  </div>
</div>

<!-- âœ… 2. ê²€ìƒ‰(Filter) ì˜ì—­ -->
<div class="filter-section">
  <div class="table-header">
    <h2>Phone List Filter</h2>
  </div>

  <div class="form">
    <select id="departmentFilter" onchange="filterPhoneList()">
      <option value="">Department (ë¶€ë¬¸)</option>
      <% departments.forEach(dep => { %>
        <option value="<%= dep %>"><%= dep %></option>
      <% }) %>
    </select>

    <select id="keywordFilter" onchange="filterPhoneList()">
      <option value="">Keyword (í‚¤ì›Œë“œ)</option>
      <% keywords.forEach(kw => { %>
        <option value="<%= kw %>"><%= kw %></option>
      <% }) %>
    </select>

    <select id="importanceFilter" onchange="filterPhoneList()">
      <option value="">Importance (ì¤‘ìš”ë„)</option>
      <% importanceList.forEach(imp => { %>
        <option value="<%= imp %>"><%= imp %></option>
      <% }) %>
    </select>
  </div>
</div>

<!-- âœ… 3. ì „í™”ë²ˆí˜¸ ë¦¬ìŠ¤íŠ¸ í…Œì´ë¸” -->
<!-- âœ… 3. ì „í™”ë²ˆí˜¸ ë¦¬ìŠ¤íŠ¸ í…Œì´ë¸” -->
<div class="bottom-section">
  <div class="table-header">
    <h2>Phone List</h2>
    <div>
      <button onclick="window.open('/admin/general/board/board01/phone_list/pdf-view', '_blank')">ğŸ“„ View PDF</button>
      <button onclick="window.open('/admin/general/board/board01/phone_list/pdf-print', '_blank')">ğŸ–¨ï¸ Print PDF</button>
    </div>
  </div>

  <!-- âœ… ì—¬ê¸° divì— class="table-wrapper" ì ìš© -->
  <div class="table-wrapper">
    <table id="phoneTable" class="compact-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Department</th>
          <th>Keyword</th>
          <th>Importance</th>
          <th>Name</th>
          <th>Personal Phone</th>
          <th>Office Phone</th>
          <th>Email</th>
          <th>Note</th>
        </tr>
      </thead>
      <tbody>
        <% if (phoneList && phoneList.length > 0) { %>
          <% phoneList.forEach(item => { %>
            <tr>
              <td><%= item.id %></td>
              <td><%= item.department || '' %></td>
              <td><%= item.keyword || '' %></td>
              <td><%= item.importance || '' %></td>
              <td><%= item.name || '' %></td>
              <td><%= item.personal_phone || '' %></td>
              <td><%= item.office_phone || '' %></td>
              <td><%= item.email || '' %></td>
              <td><%= item.note || '' %></td>
            </tr>
          <% }) %>
        <% } else { %>
          <tr><td colspan="9">ì „í™”ë²ˆí˜¸ë¶€ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>
        <% } %>
      </tbody>
    </table>
  </div>
</div>


<!-- âœ… JavaScript ì „ì²´ ê¸°ëŠ¥ -->
<script>
function clearFormInputs() {
  const form = document.getElementById("phoneForm");
  const inputs = form.querySelectorAll("input, select");
  inputs.forEach(input => input.value = "");
}

function selectPhone() {
  const idInput = document.getElementById("selectedIdInput").value.trim();
  const rows = document.querySelectorAll("#phoneTable tbody tr");
  let found = false;

  rows.forEach(row => {
    const idCell = row.cells[0];
    // ëª¨ë“  highlight ì´ˆê¸°í™”
    for (let i = 0; i < row.cells.length; i++) {
      row.cells[i].classList.remove('highlight');
    }

    if (idCell && idCell.innerText.trim() === idInput) {
      found = true;
      
      // ğŸ”¥ Personal Phone, Office Phone ì»¬ëŸ¼ë§Œ highlight ì ìš©
      row.cells[5].classList.add('highlight');
      row.cells[6].classList.add('highlight');

      // ì…ë ¥í¼ì— ê°’ ì±„ì›Œë„£ê¸°
      const fields = ["department", "keyword", "importance", "name", "personal_phone", "office_phone", "email", "note"];
      fields.forEach((field, idx) => {
        const input = document.querySelector(`input[name="${field}"], select[name="${field}"]`);
        const cell = row.cells[idx + 1];
        if (input && cell) input.value = cell.innerText.trim();
      });
    }
  });

  if (!found) alert("í•´ë‹¹ IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
}


function prepareEdit() {
  const id = document.getElementById("selectedIdInput").value.trim();
  if (!id) {
    alert("ìˆ˜ì •í•  IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
    return;
  }
  const form = document.getElementById("phoneForm");
  form.action = `/admin/general/board/board01/phone_list/edit/${id}`;
  form.submit();
}

function prepareDelete() {
  const id = document.getElementById("selectedIdInput").value.trim();
  if (!id) {
    alert("ì‚­ì œí•  IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
    return;
  }
  if (confirm(`ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ID: ${id}`)) {
    fetch(`/admin/general/board/board01/phone_list/delete/${id}`, { method: 'POST' })
      .then(() => location.reload())
      .catch(err => alert('ì‚­ì œ ì‹¤íŒ¨: ' + err));
  }
}

function filterPhoneList() {
  const department = document.getElementById('departmentFilter').value;
  const keyword = document.getElementById('keywordFilter').value;
  const importance = document.getElementById('importanceFilter').value;
  const rows = document.querySelectorAll("#phoneTable tbody tr");

  rows.forEach(row => {
    const dept = row.cells[1].innerText.trim();
    const keyw = row.cells[2].innerText.trim();
    const imp = row.cells[3].innerText.trim();

    const matchDept = !department || dept === department;
    const matchKeyw = !keyword || keyw === keyword;
    const matchImp = !importance || imp === importance;

    if (matchDept && matchKeyw && matchImp) {
      row.style.display = "";

      // âœ… Personal Phone, Office Phone ì¹¸ì„ ë…¸ë€ìƒ‰ highlight ì ìš©
      row.cells[5].classList.add('highlight');
      row.cells[6].classList.add('highlight');

    } else {
      row.style.display = "none";

      // âœ… ìˆ¨ê¸°ëŠ” rowëŠ” highlight ì§€ì›Œì£¼ê¸°
      row.cells[5].classList.remove('highlight');
      row.cells[6].classList.remove('highlight');
    }
  });
}

</script>

</body>
</html>
