<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Import PO Input</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #f5f7fa;
      color: #333;
      display: flex;
      flex-direction: column;
      height: 100vh;
      font-size: 12px;
    }

    .top-section {
      flex: 0 0 auto;
      padding: 10px;
    }

    .bottom-section {
      flex: 1 1 auto;
      padding: 10px;
      overflow-y: auto;
    }

    h2 {
      font-size: 20px;
      color: #333;
      margin-bottom: 15px;
    }

    .form {
      width: 100%;
    }

    .form-row {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
      align-items: center;
    }

    input, select, textarea {
      padding: 4px;
      font-size: 12px;
      border: 1px solid #ccc;
      border-radius: 4px;
      height: 24px;
    }

    button {
      padding: 4px 12px;
      font-size: 12px;
      border: 1px solid #066da5;
      border-radius: 4px;
      background-color: #fff;
      cursor: pointer;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 4px;
      text-align: center;
      font-weight: normal;
      font-size: 12px;
    }

    td.negative {
      color: red;
    }

    th {
      background-color: #f0f8ff;
      position: sticky;
      top: 0;
      z-index: 1;
    }

    .table-wrapper {
      max-height: 550px;
      overflow-y: auto;
      border: 1px solid #ccc;
    }

    .filter-section {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 10px;
      justify-content: space-between;
    }
  </style>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const vendorSelects = document.querySelectorAll('select[name="v_name"]');
      const vRateInput = document.querySelector('input[name="v_rate"]');

      vendorSelects.forEach(vendorSelect => {
        if (vendorSelect && vRateInput) {
          vendorSelect.addEventListener('change', () => {
            const selectedOption = vendorSelect.options[vendorSelect.selectedIndex];
            const rate = selectedOption.getAttribute('data-rate');
            vRateInput.value = rate || '';
          });

          const initialRate = vendorSelect.options[vendorSelect.selectedIndex]?.getAttribute('data-rate');
          vRateInput.value = initialRate || '';
        }
      });

      const inputs = document.querySelectorAll('input, select, textarea');
      inputs.forEach((el, index) => {
        el.addEventListener('keydown', (e) => {
          if (e.key === 'Enter') {
            e.preventDefault();
            const next = inputs[index + 1];
            if (next) next.focus();
          }
        });
      });
    });
  </script>
</head>
<body>
  <div class="top-section">
    <h2>Import PO Input</h2>

    <div style="display: flex; gap: 40px; align-items: flex-start;">
      <!-- ‚úÖ 1Ï∞® Î∞©Ïãù ÏûÖÎ†• (PCS * COST) -->
      <form method="POST" action="/admin/import_po/add/po" class="form" style="flex: 1;">
        <div class="form-row">
          <input type="date" name="po_date" id="shared-date" value="<%= today %>">
          <select name="v_name" id="shared-vendor" required>
            <% vendors.forEach(v => { %>
              <option value="<%= v.v_name %>" data-rate="<%= v.v_rate %>"><%= v.v_name %></option>
            <% }) %>
          </select>
          <input type="text" name="v_rate" placeholder="Deposit Rate" readonly>
        </div>
        <div class="form-row">
          <label style="white-space: nowrap;">PO ÏûÖÎ†•</label>
          <input type="text" name="style" placeholder="Style">
          <input type="text" name="po_no" placeholder="PO No.">
          <input type="number" name="pcs" placeholder="PCS" step="1">
          <input type="number" name="cost" placeholder="Cost" step="0.01">
          <button type="submit">‚ûï ÏûÖÎ†•</button>
        </div>
      </form>

      <!-- ‚úÖ 2Ï∞® Î∞©Ïãù ÏûÖÎ†• (Îã®Ïùº Í∏àÏï° / deposit ÏóÜÏùå) -->
      <form method="POST" action="/admin/import_po/add/direct" class="form" style="flex: 1;">
        <div class="form-row"> 
           <!-- ‚úÖ Ïà®Í≤®ÏÑú Í∞ÄÏ†∏Ïò¨ ÌïÑÎìú -->
          <input type="hidden" name="po_date" id="hidden-date">
          <input type="hidden" name="v_name" id="hidden-vendor">        

          <label style="white-space: nowrap;">Í∏∞ÌÉÄ ÏûÖÎ†•</label>
          <input type="text" name="style" placeholder="ÏûÖÎ†•Ï¢ÖÎ•ò">
          <input type="number" name="cost" placeholder="Amount" step="0.01">
          <input type="hidden" name="v_rate" value="">
          <button type="submit">‚ûï ÏûÖÎ†•</button>
        </div>
      </form>
    </div>
  </div>

  <div class="bottom-section">
    <div class="filter-section">
      <div>
        <select name="v_name">
          <option>:: Vendor Name ::</option>
        </select>
        <select name="po_no">
          <option>:: PO No. ::</option>
        </select>
        <select name="style">
          <option>:: Style ::</option>
        </select>
      </div>
      <div>
        <input type="date" name="pay_date" value="<%= today %>">
        <input type="number" step="0.0001" name="exchange_rate" placeholder="Exchange Rate">
        <button type="submit">üí∞ Paid</button>
        <a href="/admin/import_po/result"><button type="button">üìä Result</button></a>
      </div>
    </div>

    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>Vendor</th>
            <th>PO Date</th>
            <th>Style</th>
            <th>PO No.</th>
            <th>PCS</th>
            <th>Cost</th>
            <th>PO A. (RMB)</th>
            <th>Deposit Rate</th>
            <th>Deposit A. (RMB)</th>
            <th>Deposit Select</th>
            <th>Deposit</th>
            <th>Balance (RMB)</th>
            <th>Balance Select</th>
            <th>Balance</th>
            <th>Note</th>
            <th>‚úèÔ∏è</th>
            <th>üóëÔ∏è</th>
          </tr>
        </thead>
        <tbody>
          <% importPOs.forEach(po => { if (po.balance !== 0) { %>
            <tr>
              <td><%= po.v_name %></td>
              <td><%= new Date(po.po_date).toLocaleDateString('en-US') %></td>
              <td><%= po.style %></td>
              <td><%= po.po_no %></td>
              <td><%= po.pcs %></td>
              <td class="<%= po.cost < 0 ? 'negative' : '' %>"><%= Number(po.cost).toLocaleString() %></td>
              <td class="<%= po.po_amount < 0 ? 'negative' : '' %>"><%= Number(po.po_amount).toLocaleString() %></td>
              <td><%= po.v_rate %></td>
              <td class="<%= po.dp_amount < 0 ? 'negative' : '' %>"><%= Number(po.dp_amount).toLocaleString() %></td>
              <td><input type="checkbox" name="deposit_ids" value="<%= po.id %>"></td>
              <td><button type="button">üí≤</button></td>
              <td class="<%= po.balance < 0 ? 'negative' : '' %>"><%= Number(po.balance).toLocaleString() %></td>
              <td><input type="checkbox" name="balance_ids" value="<%= po.id %>"></td>
              <td><button type="button">üí≤</button></td>
              <td><%= po.note %></td>
              <td><a href="/admin/import_po/edit/<%= po.id %>"><button>‚úèÔ∏è</button></a></td>
              <td>
                <form method="POST" action="/admin/import_po/delete/<%= po.id %>" onsubmit="return confirm('ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?');">
                  <button type="submit">üóëÔ∏è</button>
                </form>
              </td>
            </tr>
          <% }}) %>
        </tbody>
      </table>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const sharedDate = document.getElementById('shared-date');
      const sharedVendor = document.getElementById('shared-vendor');
    
      const hiddenDate = document.getElementById('hidden-date');
      const hiddenVendor = document.getElementById('hidden-vendor');
      const hiddenRate = document.querySelector('input[name="v_rate"]');
    
      function syncHiddenFields() {
        hiddenDate.value = sharedDate.value;
        hiddenVendor.value = sharedVendor.value;
    
        const selected = sharedVendor.options[sharedVendor.selectedIndex];
        const rate = selected.getAttribute('data-rate') || '';
        hiddenRate.value = rate;
      }
    
      // Ï≤òÏùå Î°úÎìú Ïãú, vendor Î≥ÄÍ≤Ω Ïãú, date Î≥ÄÍ≤Ω Ïãú ÎèôÍ∏∞Ìôî
      sharedDate.addEventListener('change', syncHiddenFields);
      sharedVendor.addEventListener('change', syncHiddenFields);
      syncHiddenFields(); // ÏµúÏ¥à Ïã§Ìñâ
    
      // 2Ï∞® form Ï†úÏ∂ú ÏßÅÏ†ÑÏóêÎèÑ ÎèôÍ∏∞Ìôî
      const directForm = document.querySelector('form[action="/admin/import_po/add/direct"]');
      if (directForm) {
        directForm.addEventListener('submit', syncHiddenFields);
      }
    });

document.addEventListener('DOMContentLoaded', () => {
  const poDateInput = document.getElementById('shared-date');

  // 1. ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï†ÄÏû•Îêú Í∞í ÏûàÏúºÎ©¥ ÎÑ£Í∏∞
  const savedDate = localStorage.getItem('po_date');
  if (savedDate) {
    poDateInput.value = savedDate;
  }

  // 2. ÏÇ¨Ïö©ÏûêÍ∞Ä ÎÇ†Ïßú Î∞îÍæ∏Î©¥ Ï†ÄÏû•
  poDateInput.addEventListener('change', () => {
    localStorage.setItem('po_date', poDateInput.value);
  });
});

document.addEventListener('DOMContentLoaded', () => {
  const sharedVendor = document.getElementById('shared-vendor');

  // 1. Ï†ÄÏû•Îêú vendor name Î≥µÏõê
  const savedVendor = localStorage.getItem('v_name');
  if (savedVendor) {
    for (let i = 0; i < sharedVendor.options.length; i++) {
      if (sharedVendor.options[i].value === savedVendor) {
        sharedVendor.selectedIndex = i;
        break;
      }
    }
  }

  // 2. ÏÇ¨Ïö©ÏûêÍ∞Ä Î≥ÄÍ≤ΩÌï† Îïå Ï†ÄÏû•
  sharedVendor.addEventListener('change', () => {
    localStorage.setItem('v_name', sharedVendor.value);
  });
});


    </script>

</body>
</html>